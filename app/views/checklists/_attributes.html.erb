<%= labelled_fields_for :checklist, @checklist do |f| %>

<div class="splitcontent">
  <div class="splitcontentleft">
    <% if @checklist.safe_attribute?('status_id') && @allowed_statuses.present? %>
      <p>
        <%= f.select :status_id, (@allowed_statuses.collect {|p| [p.name, p.id]}), {:required => true},
          :onchange => "updateIssueFrom('#{escape_javascript(update_issue_form_path(@project, @checklist))}', this)" %>
      </p>
      <%= hidden_field_tag 'was_default_status', @checklist.status_id, :id => nil if @checklist.status == @checklist.default_status %>
    <% else %>
      <p><label><%= l(:field_status) %></label> <%= @checklist.status %></p>
    <% end %>

    <% if @checklist.safe_attribute? 'priority_id' %>
      <p><%= f.select :priority_id, (@priorities.collect {|p| [p.name, p.id]}), {:required => true} %></p>
    <% end %>

    <% if @checklist.safe_attribute? 'assigned_to_id' %>
      <p>
        <%= f.select :assigned_to_id, principals_options_for_select(@checklist.assignable_users, @checklist.assigned_to),
          :include_blank => true, :required => @checklist.required_attribute?('assigned_to_id') %>
      </p>
    <% end %>

    <% if @checklist.safe_attribute?('category_id') && @project.issue_categories.any? %>
      <p>
        <%= f.select :category_id, (@checklist.project.issue_categories.collect {|c| [c.name, c.id]}),
          {:include_blank => true, :required => @checklist.required_attribute?('category_id')},
          :onchange => ("updateIssueFrom('#{escape_javascript(update_issue_form_path(@project, @checklist))}', this)" if @checklist.new_record?) %>
        <%= link_to(l(:label_issue_category_new),
          new_project_issue_category_path(@project),
          :remote => true,
          :method => 'get',
          :title => l(:label_issue_category_new),
          :tabindex => 200,
          :class => 'icon-only icon-add'
        ) if User.current.allowed_to?(:manage_categories, @checklist.project) %>
      </p>
    <% end %>

    <% if @checklist.safe_attribute?('fixed_version_id') && @checklist.assignable_versions.any? %>
    <p><%= f.select :fixed_version_id, version_options_for_select(@checklist.assignable_versions, @checklist.fixed_version),
                    :include_blank => true, :required => @checklist.required_attribute?('fixed_version_id') %>
    <%= link_to(l(:label_version_new),
                new_project_version_path(@checklist.project),
                :remote => true,
                :method => 'get',
                :title => l(:label_version_new),
                :tabindex => 200,
                :class => 'icon-only icon-add'
               ) if User.current.allowed_to?(:manage_versions, @checklist.project) %>
    </p>
    <% end %>
  </div>

  <div class="splitcontentright">
    <% if @checklist.safe_attribute? 'start_date' %>
    <p id="start_date_area">
      <%= f.date_field(:start_date, :size => 10, :required => @checklist.required_attribute?('start_date')) %>
      <%= calendar_for('issue_start_date') %>
    </p>
    <% end %>

    <% if @checklist.safe_attribute? 'due_date' %>
    <p id="due_date_area">
      <%= f.date_field(:due_date, :size => 10, :required => @checklist.required_attribute?('due_date')) %>
      <%= calendar_for('issue_due_date') %>
    </p>
    <% end %>

    <% if @checklist.safe_attribute? 'estimated_hours' %>
    <p><%= f.hours_field :estimated_hours, :size => 3, :required => @checklist.required_attribute?('estimated_hours') %> <%= l(:field_hours) %></p>
    <% end %>

    <% if @checklist.safe_attribute?('done_ratio') && Issue.use_field_for_done_ratio? %>
    <p><%= f.select :done_ratio, ((0..10).to_a.collect {|r| ["#{r*10} %", r*10] }), :required => @checklist.required_attribute?('done_ratio') %></p>
    <% end %>
  </div>
</div>

<% if @checklist.safe_attribute? 'custom_field_values' %>
<%= render :partial => 'issues/form_custom_fields' %>
<% end %>

<% end %>

<% include_calendar_headers_tags %>

