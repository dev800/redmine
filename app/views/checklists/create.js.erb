<% if @checklist.save %>
  <% if params[:continue] %>
    var $form = $('form[data-form-name="' + "<%= params[:form_name] %>" + '"]');

    $form.find('[name="checklist[description]"]').val('');
    $form.find('[name="checklist[subject]"]').val('').focus();
  <% else %>
    closeHTMLDialog();
  <% end %>

  $.Toast.showToast({
    title: '<%= l(:notice_successful_create) %>',
    duration: 800,
    icon: 'success',
    image: ''
  });

  $('textarea').removeData('changed');

  $('.checklists-filter[data-issue-id="<%= @checklist.issue_id %>"]').replaceWith(
    '<%= escape_javascript(render :partial => "checklists/filter", :locals => {
      :issue => @issue,
      :checklists => @issue.queried_checklists(
        tracker: params[:checklists_tracker],
        status: params[:checklists_status]
      )
    }) %>'
  );

  $('.checklists[data-issue-id="<%= @checklist.issue_id %>"]').append(
    '<%= escape_javascript(render :partial => "checklists/checklist", :locals => { :checklist => @checklist }) %>'
  )

  if ($('.checklists[data-issue-id="<%= @checklist.issue_id %>"] > .checklist').length > 0) {
    $('.checklists-empty[data-issue-id="<%= @checklist.issue_id %>"]').hide();
  } else {
    $('.checklists-empty[data-issue-id="<%= @checklist.issue_id %>"]').show();
  }
<% else %>
  showErrorMessages(<%= raw @checklist.errors.full_messages.to_json %>, { title: '<%= l(:notice_fail_create) %>' })
<% end %>
